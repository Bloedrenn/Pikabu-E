{% load static %}

<div class="card post-card mb-4 shadow-sm">
    <div class="card-body">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Å—Ç–∞—Ç—É—Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
        <div class="d-flex justify-content-between align-items-start mb-3">
            <h2 class="card-title h4 mb-0">
                <a href="{% url 'blog:post_detail' post.slug %}" class="text-decoration-none text-dark">
                    {{ post.title }}
                </a>
            </h2>
            
            {% if request.user == post.author and request.resolver_match.url_name != 'profile' %}
            <span class="badge bg-primary bg-opacity-10 text-primary border border-primary border-opacity-25">
                <i class="bi bi-person-fill me-1"></i>–ú–æ–π –ø–æ—Å—Ç
            </span>
            {% endif %}
            
            {% if request.user in post.viewed_users.all %}
            <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25">
                <i class="bi bi-eye-fill me-1"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–æ
            </span>
            {% endif %}
        </div>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏—è -->
        <div class="mb-2">
            <span class="text-muted small">–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</span>
            <a href="{{ post.category.get_absolute_url }}" class="badge bg-primary bg-opacity-10 text-primary text-decoration-none ms-1">
                {{ post.category.name }}
            </a>
        </div>

        <!-- –¢–µ–≥–∏ -->
        <div class="mb-3">
            <span class="text-muted small">–¢–µ–≥–∏:</span>
            {% for tag in post.tags.all %}
                <a href="{{ tag.get_absolute_url }}" class="badge bg-secondary bg-opacity-10 text-secondary text-decoration-none ms-1">
                    #{{ tag.name }}
                </a>
            {% empty %}
                <span class="text-muted small ms-1">–Ω–µ—Ç —Ç–µ–≥–æ–≤</span>
            {% endfor %}
        </div>

        <!-- –¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ -->
        <div class="card-text mb-3">
            <p class="text-muted mb-1">–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞:</p>
            <p class="mb-0">{{ post.text|truncatechars:500 }}</p>
        </div>

        <!-- –§—É—Ç–µ—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ -->
        <div class="mt-3 pt-3 border-top d-flex justify-content-between align-items-center">
            <div>
                <!-- –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è -->
                <small class="text-muted">
                    <i class="bi bi-calendar3 me-1"></i>
                    <span class="date-field">{{ post.created_at|date:"c" }}</span>
                </small>
                
                <!-- üî• –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
                <small class="text-muted ms-3">
                    <i class="bi bi-chat-text me-1"></i>
                    {{ post.comments.count }}
                </small>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
            <div>
                <button
                    class="btn btn-link pe-0 {% if request.user == post.author %}disabled{% endif %} favorite-btn"
                    data-post-favorite-toggle-url="{% url "blog:post_favorite_toggle" post.id %}"
                    data-is-authenticated="{% if request.user.is_authenticated %}true{% else %}false{% endif %}"
                    data-login-url="{% url 'users:login' %}"
                >
                    {% if request.user in post.favorites.all %}
                        <i class="favorite-icon bi bi-bookmark-fill"></i>
                    {% else %}
                        <i class="favorite-icon bi bi-bookmark"></i>
                    {% endif %}
                </button>
                <span class="favorites-count">{{ post.favorites.count }}</span>
            </div>
        </div>
    </div>
</div>